<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Web Components Demo</title>

    <script src="./node_modules/@webcomponents/custom-elements/custom-elements.min.js"></script>

    <script>
        // This is Custom Elements v1 specification with ES6 code
        // Works in latest Chrome; with polyfill in Safari, Opera, Firefox and Edge
        // Does not work in Edge because support for ES6 not present; babel has bug
        // when transpiling 'extends native' https://github.com/babel/babel/issues/4480
        class NgSpan extends HTMLElement {

            constructor () {
                super ()
                this._color = 'blue'
            }

            static get observedAttributes () {
                return [ 'color' ];
            }

            attributeChangedCallback ( name, oldValue, newValue ) {
                if ( name === 'color' ) {
                    this._color = newValue
                    this.render ()
                }
            }

            connectedCallback () {
                console.log ( 'connected', this._color )
                this.render ()
            }

            disconnectedCallback () {
                console.log ( 'disconnected', this._color )
            }

            render () {
                this.innerHTML = `<b style="color: ${this._color}">I'm a ${this._color} span!</b>`
            }
        }

        customElements.define ( 'ng-span', NgSpan )

        window.addEventListener ( 'DOMContentLoaded', function ( e ) {
            let span = new NgSpan ()
            span.setAttribute ( 'color', 'red' )
            document.body.appendChild ( span )

            setTimeout ( () => {
                span.setAttribute ( 'color', 'yellow' )
                document.querySelectorAll ( 'ng-span' )[ 0 ]
                        .setAttribute ( 'color', 'fuchsia' )
                document.querySelectorAll ( 'ng-span' )[ 1 ]
                        .remove ()
            }, 3000 )
        } )
    </script>
</head>
<body>
<h1>Blue Span</h1>
<ng-span></ng-span>
<ng-span color="green"></ng-span>
<h3>Programmatic Creation</h3>
</body>
</html>
