<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Web Components Demo</title>

    <script src="./node_modules/@webcomponents/custom-elements/custom-elements.min.js"></script>

    <template id="gender-name-template">
        <style>
            gender-name h4 {
                font-family: sans-serif;
                height: 24px;
                line-height: 24px;
                margin: 0;
            }
        </style>

        <h4 class="name"></h4>

        <script>
            console.log( 'Executing template script' )
        </script>
    </template>

    <script>
        // This is Custom Elements v1 specification with ES6 code
        // Works in latest Chrome; with polyfill in Safari, Opera, Firefox and Edge
        // Has to be transpiled for IE11 due to lack of ES6 support

        class GenderName extends HTMLElement {

            constructor() {
                super()
            }

            static get observedAttributes() {
                return [ 'gender', 'name' ]
            }

            get name() {
                return this.getAttribute( 'name' ) || 'Unknown'
            }

            set name( value ) {
                this.setAttribute( 'name', value )
                this.updateName()
            }

            attributeChangedCallback( name, oldValue, newValue ) {
                console.log( 'attributeChangedCallback', name, oldValue, newValue )
                if ( name === 'name' ) {
                    if ( oldValue !== newValue ) {
                        this.name = newValue
                    }
                }
            }

            updateName() {
                console.log( 'updateName', this.name )
                const ele = this.querySelector( '.name' )
                if (ele) ele.innerHTML = this.name
            }

            connectedCallback() {
                console.log( 'connected', this.name )
                this.render()
            }

            render() {
                console.log( 'render', this.name )
                const template = document.getElementById( 'gender-name-template' )
                const nodes    = document.importNode( template.content, true )
                this.appendChild( nodes )

                this.addEventListener( 'click', e => {
                    alert( `In Component, target=${e.target.nodeName}` )
                } )

                this.updateName()
            }
        }

        customElements.define( 'gender-name', GenderName )

        window.addEventListener( 'DOMContentLoaded', function ( e ) {
            setTimeout( () => {
                const ele = document.querySelector( 'gender-name' )
                ele.name  = 'Wilma Flintstone'
            }, 3000 )

            setTimeout( () => {
                const ele = document.querySelector( 'gender-name' )
                ele.setAttribute( 'name', 'Betty Rubble' )
            }, 6000 )
        } )
    </script>
</head>
<body>

<h1>HTML Templates Example</h1>
<h4>Using a template to create DOM used within custom elements</h4>

<gender-name name="Fred Flintstone"></gender-name>

</body>
</html>
